#extensions/spatialnavigation doesn't build with libxul and bsmedberg's latest landing
Index: mozilla/extensions/spatialnavigation/src/Makefile.in
===================================================================
--- mozilla.orig/extensions/spatialnavigation/src/Makefile.in
+++ mozilla/extensions/spatialnavigation/src/Makefile.in
@@ -41,56 +41,59 @@
 VPATH=@srcdir@
 
 include $(DEPTH)/config/autoconf.mk
 
 MODULE       = snav
 LIBRARY_NAME = snav
 IS_COMPONENT = 1
 
-MOZILLA_INTERNAL_API = 1
-
-#ifdef MOZ_MICROB
-#MINIMO=1
-#FORCE_STATIC_LIB=1
-#endif
+ifdef IS_COMPONENT
+DEFINES += -DDYN_SNAV
+FORCE_SHARED_LIB = 1
+else
+LIBXUL_LIBRARY  = 1
+FORCE_STATIC_LIB = 1
+endif
 
 ifdef MINIMO
 MODULE_NAME  = snav
 EXPORT_LIBRARY = 1
 else
 ifdef MOZ_XUL_APP
-XPI_NAME               = snav
+XPI_NAME     = snav
 endif
 endif
 
-REQUIRES	= xpcom \
-		      string \
-			  pref \
-			  js \
-		      dom \
-			  dom_base \
-		      gfx \
-		      layout \
-		      content \
-		      widget \
-		      locale \
-		      necko \
-		      docshell \
-              unicharutil \
-		      view \
-		      webshell \
-			  windowwatcher \
-			  webbrwsr \
-		      $(NULL)
-
-CPPSRCS     = nsSpatialNavigation.cpp \
-			  nsSpatialNavigationUtils.cpp \
-			  nsSpatialNavigationService.cpp \
-	          $(NULL)
+REQUIRES = \
+	xpcom \
+	string \
+	pref \
+	js \
+	dom \
+	dom_base \
+	gfx \
+	layout \
+	content \
+	widget \
+	locale \
+	necko \
+	docshell \
+	unicharutil \
+	view \
+	webshell \
+	windowwatcher \
+	webbrwsr \
+	 $(NULL)
+
+CPPSRCS  = \
+	nsSpatialNavigation.cpp \
+	nsSpatialNavigationUtils.cpp \
+	nsSpatialNavigationService.cpp \
+	$(NULL)
 
 
 # This is just terrible... we need nsRect to be able to
 # interact with the layout.  However, we can't link to get
 # this class in GFX in a static build (GFX is linked into
 # the application and symbols are not expored from
 # applications).  
 #
@@ -99,21 +102,24 @@
 # defined.  We do not use this class anywhere in this
 # extension.
 
 ifndef MINIMO
 DEFINES += -D_IMPL_NS_GFX
 CPPSRCS += nsRect.cpp nsFont.cpp
 endif
 
-EXTRA_DSO_LDOPTS += $(LIBS_DIR)          \
-                    $(EXTRA_DSO_LIBS)    \
-					$(MOZ_UNICHARUTIL_LIBS) \
-                    $(MOZ_COMPONENT_LIBS)\
-                    $(NULL)
+EXTRA_DSO_LDOPTS += \
+	$(XPCOM_GLUE_LDOPTS) \
+	$(XPCOM_FROZEN_LDOPTS) \
+	$(LIBS_DIR) \
+	$(EXTRA_DSO_LIBS) \
+	$(MOZ_UNICHARUTIL_LIBS) \
+	$(MOZ_COMPONENT_LIBS)  \
+	$(NULL)
 
 include $(topsrcdir)/config/config.mk
 
 ifdef MOZ_XUL_APP
 ifdef TARGET_XPCOM_ABI
 FINAL_TARGET=$(DIST)/xpi-stage/$(XPI_NAME)/platform/$(OS_TARGET)_$(TARGET_XPCOM_ABI)
 endif
 endif
Index: mozilla/extensions/spatialnavigation/src/nsSpatialNavigationPrivate.h
===================================================================
--- mozilla.orig/extensions/spatialnavigation/src/nsSpatialNavigationPrivate.h
+++ mozilla/extensions/spatialnavigation/src/nsSpatialNavigationPrivate.h
@@ -37,17 +37,22 @@
 #include "memory.h"
 #include "stdlib.h"
 
 #include "nspr.h"
 
 #include "nsXPCOM.h"
 #include "nsCOMPtr.h"
 #include "nsMemory.h"
+
+#ifdef DYN_SNAV
+#include "nsStringAPI.h"
+#else
 #include "nsString.h"
+#endif
 
 #include "nsISpatialNavigation.h"
 
 #include "nsDirectoryServiceDefs.h"
 #include "nsDirectoryServiceUtils.h"
 #include "nsFrameTraversal.h"
 #include "nsIArray.h"
 #include "nsIBaseWindow.h"
@@ -268,9 +273,8 @@
       scriptContext->SetScriptsEnabled(PR_TRUE, PR_TRUE);
     }
       
   }
   PRBool isEnabled;
   nsIScriptContext *scriptContext;
 };
 
-
Index: mozilla/extensions/spatialnavigation/src/nsSpatialNavigationUtils.cpp
===================================================================
--- mozilla.orig/extensions/spatialnavigation/src/nsSpatialNavigationUtils.cpp
+++ mozilla/extensions/spatialnavigation/src/nsSpatialNavigationUtils.cpp
@@ -36,16 +36,18 @@
 
 #include "nsSpatialNavigationPrivate.h"
 #include "nsIDOMNSElement.h"
 #include "nsIDOMTextRectangle.h"
 
 #ifdef DEBUG_outputframes
 #include "nsIFrameDebug.h"
 #endif
+#include "nsComponentManagerUtils.h"
+#include "nsRect.h"
 
 static PRBool is_space(char c)
 {
   return (c == ' '  || c == '\f' || c == '\n' ||
           c == '\r' || c == '\t' || c == '\v');
 }
 
 nscoord* lo_parse_coord_list(char *str, PRInt32* value_cnt)
