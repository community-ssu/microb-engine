# Patches for microb-engine
# Oleg Romashin <ext-oleg.2.romashin@nokia.com>
# Bug 372077  TestGtkEmbed Application should use gtk_moz_embed_*_startup properly

Index: mozilla/embedding/browser/gtk/tests/TestGtkEmbed.cpp
===================================================================
--- mozilla.orig/embedding/browser/gtk/tests/TestGtkEmbed.cpp
+++ mozilla/embedding/browser/gtk/tests/TestGtkEmbed.cpp
@@ -250,17 +250,19 @@
   if (!single) {
     fprintf(stderr, "Failed to get singleton embed object!\n");
     exit(1);
   }
 
   gtk_signal_connect(GTK_OBJECT(single), "new_window_orphan",
 		     GTK_SIGNAL_FUNC(new_window_orphan_cb), NULL);
 
+  gtk_moz_embed_push_startup();
   gtk_main();
+  gtk_moz_embed_pop_startup();
 }
 
 static TestGtkBrowser *
 new_gtk_browser(guint32 chromeMask)
 {
   guint32         actualChromeMask = chromeMask;
   TestGtkBrowser *browser = 0;
 
