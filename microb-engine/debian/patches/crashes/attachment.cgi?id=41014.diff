#bug https://projects.maemo.org/bugzilla/show_bug.cgi?id=100612
Index: mozilla/widget/src/gtk2/mozdrawingarea.c
===================================================================
--- mozilla.orig/widget/src/gtk2/mozdrawingarea.c
+++ mozilla/widget/src/gtk2/mozdrawingarea.c
@@ -159,16 +159,18 @@ moz_drawingarea_create_windows (MozDrawi
     attributes.window_type = GDK_WINDOW_CHILD;
     if (!visual) {
         attributes.visual = gtk_widget_get_visual (widget);
         attributes.colormap = gtk_widget_get_colormap (widget);
     } else {
         attributes.visual = visual;
         attributes.colormap = gdk_colormap_new(visual, 0);
     }
+    if (widget && !GTK_WIDGET_REALIZED(widget))
+      return;
 
     attributes_mask |= GDK_WA_VISUAL | GDK_WA_COLORMAP |
         GDK_WA_X | GDK_WA_Y;
 
     drawingarea->clip_window = gdk_window_new (parent, &attributes,
                                                attributes_mask);
     gdk_window_set_user_data(drawingarea->clip_window, widget);
 
Index: mozilla/widget/src/gtk2/nsWindow.cpp
===================================================================
--- mozilla.orig/widget/src/gtk2/nsWindow.cpp
+++ mozilla/widget/src/gtk2/nsWindow.cpp
@@ -7171,16 +7171,17 @@ nsWindow::GetSurfaceForGdkDrawable(GdkDr
     return result;
 }
 #endif
 
 // return the gfxASurface for rendering to this widget
 gfxASurface*
 nsWindow::GetThebesSurface()
 {
+    if (!mDrawingarea) return NULL;
     GdkDrawable* d;
     gint x_offset, y_offset;
     gdk_window_get_internal_paint_info(mDrawingarea->inner_window,
                                        &d, &x_offset, &y_offset);
 
 #ifdef MOZ_X11
     gint width, height;
     gdk_drawable_get_size(d, &width, &height);
