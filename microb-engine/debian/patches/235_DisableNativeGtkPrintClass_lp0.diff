# Patches for microb-engine
# Oleg Romashin <ext-oleg.2.romashin@nokia.com>
# DP: Additional disabling Printing support

Index: widget/src/gtk2/Makefile.in
===================================================================
--- widget/src/gtk2/Makefile.in.orig
+++ widget/src/gtk2/Makefile.in
@@ -78,18 +78,23 @@ ifeq ($(MOZ_ENABLE_GLITZ),1)
 REQUIRES += glitz glitzglx
 endif
 endif
 
 CSRCS		= \
 		mozcontainer.c \
 		mozdrawingarea.c \
 		keysym2ucs.c \
+		$(NULL)
+
+ifndef MOZ_MICROB
+CSRCS		+= \
 		nsPrintdGTK.c \
 		$(NULL)
+endif
 
 ifdef ACCESSIBILITY
 CSRCS += maiRedundantObjectFactory.c
 endif
 
 CPPSRCS		= \
 		nsWindow.cpp \
 		nsAppShell.cpp \
@@ -100,27 +105,27 @@ CPPSRCS		= \
 		nsLookAndFeel.cpp \
 		nsGtkKeyUtils.cpp \
 		nsClipboard.cpp \
 		nsDragService.cpp \
 		nsSound.cpp \
 		nsNativeKeyBindings.cpp \
 		nsScreenGtk.cpp \
 		nsScreenManagerGtk.cpp \
-		nsDeviceContextSpecG.cpp \
-		nsPrintOptionsGTK.cpp \
 		nsImageToPixbuf.cpp \
 		nsAccessibilityHelper.cpp \
 		nsTempfilePS.cpp \
 		nsIdleServiceGTK.cpp \
 		$(NULL)
 
 ifndef MOZ_MICROB
 CPPSRCS		+= \
 		nsFilePicker.cpp \
+		nsDeviceContextSpecG.cpp \
+		nsPrintOptionsGTK.cpp \
 		$(NULL)
 endif
 
 ifdef MOZ_ENABLE_POSTSCRIPT
 CPPSRCS        += \
 		nsPrintJobFactoryGTK.cpp \
 		nsPrintJobGTK.cpp \
 		$(NULL)
Index: widget/src/gtk2/nsWidgetFactory.cpp
===================================================================
--- widget/src/gtk2/nsWidgetFactory.cpp.orig
+++ widget/src/gtk2/nsWidgetFactory.cpp
@@ -50,19 +50,21 @@
 #include "nsDragService.h"
 #ifndef MOZ_MICROB
 #include "nsFilePicker.h"
 #endif
 #include "nsSound.h"
 #include "nsBidiKeyboard.h"
 #include "nsNativeKeyBindings.h"
 #include "nsScreenManagerGtk.h"
+#ifndef MOZ_MICROB
 #include "nsPrintOptionsGTK.h"
 #include "nsPrintSession.h"
 #include "nsDeviceContextSpecG.h"
+#endif
 #include "nsIPrefService.h"
 #include "nsIPrefBranch.h"
 #include "nsImageToPixbuf.h"
 #include "nsIdleServiceGTK.h"
 
 #ifdef NATIVE_THEME_SUPPORT
 #include "nsNativeThemeGTK.h"
 #endif
@@ -87,23 +89,27 @@ NS_GENERIC_FACTORY_CONSTRUCTOR(nsLookAnd
 NS_GENERIC_FACTORY_CONSTRUCTOR(nsTransferable)
 NS_GENERIC_FACTORY_CONSTRUCTOR(nsBidiKeyboard)
 NS_GENERIC_FACTORY_CONSTRUCTOR(nsClipboardHelper)
 NS_GENERIC_FACTORY_CONSTRUCTOR(nsHTMLFormatConverter)
 NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(nsClipboard, Init)
 NS_GENERIC_FACTORY_CONSTRUCTOR(nsDragService)
 NS_GENERIC_FACTORY_CONSTRUCTOR(nsSound)
 NS_GENERIC_FACTORY_CONSTRUCTOR(nsScreenManagerGtk)
+#ifndef MOZ_MICROB
 NS_GENERIC_FACTORY_CONSTRUCTOR(nsDeviceContextSpecGTK)
+#endif
 #ifdef NATIVE_THEME_SUPPORT
 NS_GENERIC_FACTORY_CONSTRUCTOR(nsNativeThemeGTK)
 #endif
+#ifndef MOZ_MICROB
 NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(nsPrintOptionsGTK, Init)
 NS_GENERIC_FACTORY_CONSTRUCTOR(nsPrinterEnumeratorGTK)
 NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(nsPrintSession, Init)
+#endif
 NS_GENERIC_FACTORY_CONSTRUCTOR(nsImageToPixbuf)
 NS_GENERIC_FACTORY_CONSTRUCTOR(nsIdleServiceGTK)
 
 #ifndef MOZ_MICROB
 static NS_IMETHODIMP
 nsFilePickerConstructor(nsISupports *aOuter, REFNSIID aIID,
                         void **aResult)
 {
@@ -251,16 +257,17 @@ static const nsModuleComponentInfo compo
     "@mozilla.org/gfx/screenmanager;1",
     nsScreenManagerGtkConstructor },
 #ifdef NATIVE_THEME_SUPPORT
    { "Native Theme Renderer",
     NS_THEMERENDERER_CID,
     "@mozilla.org/chrome/chrome-native-theme;1",
      nsNativeThemeGTKConstructor },
 #endif
+#ifndef MOZ_MICROB
   { "PrintSettings Service",
     NS_PRINTSETTINGSSERVICE_CID,
     "@mozilla.org/gfx/printsettings-service;1",
     nsPrintOptionsGTKConstructor },
   { "Gtk Printer Enumerator",
     NS_PRINTER_ENUMERATOR_CID,
     //    "@mozilla.org/gfx/printer_enumerator/gtk;1",
     "@mozilla.org/gfx/printerenumerator;1",
@@ -269,16 +276,17 @@ static const nsModuleComponentInfo compo
     NS_PRINTSESSION_CID,
     "@mozilla.org/gfx/printsession;1",
     nsPrintSessionConstructor },
   { "Gtk Device Context Spec",
     NS_DEVICE_CONTEXT_SPEC_CID,
     //    "@mozilla.org/gfx/device_context_spec/gtk;1",
     "@mozilla.org/gfx/devicecontextspec;1",
     nsDeviceContextSpecGTKConstructor },
+#endif
   { "Image to gdk-pixbuf converter",
     NS_IMAGE_TO_PIXBUF_CID,
     "@mozilla.org/widget/image-to-gdk-pixbuf;1",
     nsImageToPixbufConstructor },
   { "User Idle Service",
     NS_IDLE_SERVICE_CID,
     "@mozilla.org/widget/idleservice;1",
     nsIdleServiceGTKConstructor },
