# NOBUGFIXME
# don't remember, but probably this is bug same as 
#Bug 389638  Broken cairo linkage in embedding-profile < default
# + canvas Xrender linking if MOZ_TREE_CAIRO disabled
--- mozilla/toolkit/library/Makefile.in.orig	2007-09-12 03:58:56.000000000 +0300
+++ mozilla/toolkit/library/Makefile.in	2007-09-12 03:54:32.000000000 +0300
@@ -197,20 +197,30 @@ EXTRA_DSO_LDOPTS += $(XLDFLAGS) $(XLIBS)
 endif
 
 ifdef MOZ_ENABLE_XFT
 EXTRA_DSO_LDOPTS += $(FT2_LIBS)
 endif
 
 ifdef MOZ_ENABLE_STARTUP_NOTIFICATION
 EXTRA_DSO_LDOPTS += $(MOZ_STARTUP_NOTIFICATION_LIBS)
 endif
 
+ifdef MOZ_ENABLE_CAIRO_GFX
+EXTRA_DSO_LDOPTS += $(MOZ_CAIRO_LIBS)
+endif
+
+ifndef MOZ_CAIRO_TREE
+ifdef MOZ_ENABLE_CANVAS
+EXTRA_DSO_LDOPTS += $(MOZ_CAIRO_LIBS) -lXrender
+endif
+endif
+
 ifeq ($(OS_ARCH),BeOS)
 EXTRA_DSO_LDOPTS += -lbe -ltracker
 endif
 
 ifeq ($(OS_ARCH),WINNT)
 EXTRA_DSO_LDOPTS += $(call EXPAND_LIBNAME,shell32 ole32 uuid version winspool comdlg32 imm32 winmm wsock32)
 ifneq (,$(MOZ_DEBUG)$(NS_TRACE_MALLOC))
 EXTRA_DSO_LDOPTS += $(call EXPAND_LIBNAME,imagehlp)
 endif
 endif # WINNT
--- mozilla/layout/build/Makefile.in.orig	2008-01-07 17:02:25.000000000 +0200
+++ mozilla/layout/build/Makefile.in	2008-01-07 17:21:14.000000000 +0200
@@ -251,11 +251,11 @@ endif
 endif
 
 ifdef MOZ_ENABLE_GTK2
 EXTRA_DSO_LDOPTS += $(MOZ_GTK2_LIBS) \
 		    $(NULL)
-ifdef MOZ_ENABLE_CAIRO_GFX
+ifdef MOZ_ENABLE_CANVAS
 EXTRA_DSO_LDOPTS += -lXrender \
 		    $(NULL)
 endif
 endif
 
