# Patches for microb-engine
# Oleg Romashin <ext-oleg.2.romashin@nokia.com>
# Bug 93213  embedding/browser/gtk/tests built even with --disable-tests

Index: mozilla/configure.in
===================================================================
--- mozilla.orig/configure.in
+++ mozilla/configure.in
@@ -5960,16 +5960,29 @@ MOZ_ARG_ENABLE_BOOL(xpctools,
 dnl ========================================================
 dnl build the tests by default
 dnl ========================================================
 MOZ_ARG_DISABLE_BOOL(tests,
 [  --disable-tests         Do not build test libraries & programs],
     ENABLE_TESTS=,
     ENABLE_TESTS=1 )
 
+
+dnl ========================================================
+dnl you can enable some tests even if tests are disabled by
+dnl previous option
+dnl ========================================================
+ENABLE_EMBEDDING_TESTS=$ENABLE_TESTS
+MOZ_ARG_ENABLE_BOOL(embedding-tests,
+[  --enable-embedding-tests
+                           Do build embedding tests libraries & programs,
+                           even if tests are disabled],
+    ENABLE_EMBEDDING_TESTS=1,
+    ENABLE_EMBEDDING_TESTS= )
+
 dnl ========================================================
 dnl =
 dnl = Module specific options
 dnl =
 dnl ========================================================
 MOZ_ARG_HEADER(Individual module options)
 
 dnl ========================================================
@@ -7622,16 +7635,17 @@ AC_SUBST(MOZ_XPRINT_CFLAGS)
 AC_SUBST(MOZ_XPRINT_LDFLAGS)
 AC_SUBST(MOZ_ENABLE_XPRINT)
 AC_SUBST(MOZ_ENABLE_POSTSCRIPT)
 
 AC_SUBST(XPCOM_USE_LEA)
 AC_SUBST(BUILD_STATIC_LIBS)
 AC_SUBST(MOZ_ENABLE_LIBXUL)
 AC_SUBST(ENABLE_TESTS)
+AC_SUBST(ENABLE_EMBEDDING_TESTS)
 AC_SUBST(IBMBIDI)
 AC_SUBST(SUNCTL)
 AC_SUBST(MOZ_UNIVERSALCHARDET)
 AC_SUBST(ACCESSIBILITY)
 AC_SUBST(MOZ_XPINSTALL)
 AC_SUBST(MOZ_VIEW_SOURCE)
 AC_SUBST(MOZ_SINGLE_PROFILE)
 AC_SUBST(MOZ_SPELLCHECK)
Index: mozilla/config/autoconf.mk.in
===================================================================
--- mozilla.orig/config/autoconf.mk.in
+++ mozilla/config/autoconf.mk.in
@@ -112,16 +112,17 @@ INCREMENTAL_LINKER = @INCREMENTAL_LINKER
 MACOSX_DEPLOYMENT_TARGET = @MACOSX_DEPLOYMENT_TARGET@
 MOZ_MAIL_NEWS	= @MOZ_MAIL_NEWS@
 MOZ_CALENDAR	= @MOZ_CALENDAR@
 MOZ_PLAINTEXT_EDITOR_ONLY = @MOZ_PLAINTEXT_EDITOR_ONLY@
 MOZ_COMPOSER = @MOZ_COMPOSER@
 BUILD_STATIC_LIBS = @BUILD_STATIC_LIBS@
 MOZ_ENABLE_LIBXUL = @MOZ_ENABLE_LIBXUL@
 ENABLE_TESTS	= @ENABLE_TESTS@
+ENABLE_EMBEDDING_TESTS	= @ENABLE_EMBEDDING_TESTS@
 IBMBIDI = @IBMBIDI@
 MOZ_UNIVERSALCHARDET = @MOZ_UNIVERSALCHARDET@
 SUNCTL = @SUNCTL@
 ACCESSIBILITY = @ACCESSIBILITY@
 MOZ_VIEW_SOURCE = @MOZ_VIEW_SOURCE@
 MOZ_XPINSTALL = @MOZ_XPINSTALL@
 MOZ_JSLOADER  = @MOZ_JSLOADER@
 MOZ_USE_NATIVE_UCONV = @MOZ_USE_NATIVE_UCONV@
Index: mozilla/embedding/browser/gtk/gtkembed.pkg
===================================================================
--- mozilla.orig/embedding/browser/gtk/gtkembed.pkg
+++ mozilla/embedding/browser/gtk/gtkembed.pkg
@@ -1,9 +1,11 @@
 [gtkembed]
 dist/bin/@DLLP@gtkembedmoz@DLLS@
+#if ENABLE_EMBEDDING_TESTS
 dist/bin/TestGtkEmbed
+#endif
 
 #if ENABLE_TESTS
 dist/bin/TestGtkEmbedNotebook@BINS@
 dist/bin/TestGtkEmbedSocket@BINS@
 dist/bin/TestGtkEmbedChild@BINS@
 #endif
Index: mozilla/embedding/browser/gtk/Makefile.in
===================================================================
--- mozilla.orig/embedding/browser/gtk/Makefile.in
+++ mozilla/embedding/browser/gtk/Makefile.in
@@ -42,15 +42,13 @@ srcdir		= @srcdir@
 VPATH		= @srcdir@
 
 include $(DEPTH)/config/autoconf.mk
 
 MODULE		= gtkembedmoz
 
 DIRS=src
 
-ifdef ENABLE_TESTS
 TOOL_DIRS  += tests
-endif
 
 PACKAGE_FILE = gtkembed.pkg
 
 include $(topsrcdir)/config/rules.mk
